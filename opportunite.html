<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Opportunités | INSA Alumni HDF</title>
    <link rel="icon" type="image/png" href="img/ico.png">
    <link rel="stylesheet" href="styles.css" />
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
</head>

<body>

    <!-- HEADER -->


    <!-- SIDEBAR MOBILE -->


    <div class="container" id="fiche-container">
    </div>

    <!-- FOOTER -->

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('js/sw.js')
                .catch(() => { });
        }
    </script>

    <!-- Données -->
    <script src="js/opportunites.js"></script>

    <!-- Rendu dynamique — respecte EXACTEMENT la structure HTML affichée avant -->
    <script>
        (function () {
            const params = new URLSearchParams(location.search);
            const id = params.get("id");
            const data = (window.OPPORTUNITES || []).find(o => String(o.id) === String(id));
            const root = document.getElementById("fiche-container");

            function renderDocs(docsField) {
                if (!docsField || docsField === "-") return "-";
                const items = Array.isArray(docsField)
                    ? docsField
                    : String(docsField).split(";").map(s => s.trim()).filter(Boolean);
                return items.map(item => {
                    const href = item;
                    const label = item.replace(/^.*\//, "");
                    return `<a href="${href}" target="_blank" rel="noopener noreferrer">${label}</a>`;
                }).join("");
            }

            if (!data) {
                root.innerHTML = `
        <a href="Trouver-une-opportunité.html" class="back-btn">← Retour aux offres</a>
        <div class="info" style="margin-top:1rem"><strong>Offre introuvable.</strong></div>`;
                return;
            }

            const contactName = data.contact?.name || "-";
            const contactEmail = data.contact?.email || "";
            const contactPhone = data.contact?.phone || "-";

            root.innerHTML = `
      <h2 class="section-title">Informations sur l'entreprise</h2>
      <div class="info"><strong>Nom :</strong> ${data.company || "-"}</div>
      <div class="info"><strong>Secteur d'activité :</strong> ${data.sector || "-"}</div>
      <div class="info"><strong>Taille :</strong> ${data.companySize || "-"}</div>
      <div class="info"><strong>Lieu de travail :</strong> ${data.location || "-"}</div>

      <h2 class="section-title">Informations sur le poste</h2>
      <div class="info"><strong>Intitulé du poste :</strong> ${data.title}</div>
      <div class="info"><strong>Description :</strong></div>
      <div class="description" style="white-space: pre-line;">${data.description || "-"}</div>
      <div class="info"><strong>Durée :</strong> ${data.duration || "-"}</div>
      <div class="info"><strong>Filières privilégiées :</strong> ${data.filieres || "-"}</div>
      <div class="info"><strong>Date limite pour postuler :</strong> ${data.deadline || "-"}</div>
      <div class="info"><strong>Documentation :</strong>${renderDocs(data.docs)}</div>

      <h2 class="section-title">Contact</h2>
      <div class="info"><strong>Nom :</strong> ${contactName}</div>
      <div class="info"><strong>Email :</strong> ${contactEmail ? `<a href="mailto:${contactEmail}">${contactEmail}</a>` : "-"
                }</div>
      <div class="info"><strong>Téléphone :</strong> ${contactPhone}</div>

      <a href="Trouver-une-opportunité.html" class="back-btn">← Retour aux offres</a>
      ${[
                    data.applyUrl ? `<a href="${data.applyUrl}" class="btn-contact" target="_blank" rel="noopener noreferrer">Postuler</a>` : "",
                    contactEmail ? `<a href="mailto:${contactEmail}" class="btn-contact">Contacter</a>` : ""
                ].join("")}
    `;
        })();
    </script>


    <!-- Script UI commun -->
    <script src="js/script.js"></script>
</body>

</html>